# 单元测试在整个测试体系中的位置

单元测试是软件测试体系中的一员。

## 1. 软件测试的类别

软件测试主要有以下这些类别：

* **单元测试**。对底层代码的每个工作单元进行测试。通常涉及一个类的一个公开方法。白盒测试。细粒度
* **集成测试**。中等粒度的测试。对多个类之间的协作或与外部系统的交互以完成某项内部功能进行测试。涉及多个类的交互。白盒测试。中等粒度。
* **功能测试**。粗粒度的测试。针对系统的每个用例（对客户或用户有用的功能）进行测试。黑盒测试。粗粒度。
* **性能和负载测试**。测试系统的性能和吞吐量等。黑盒测试。
* **验收测试**。从用户界面开始对整个系统进行测试验收，检验系统是否已经准备就绪，可以部署生产。

| 类别     | 测试对象         |涉及范围| 黑盒/白盒 | 粒度   |
| -------- | ------------ | --------- | ------ |------|
| 单元测试 | 一个工作单元 |通常是类内部的一个方法。对协作者（其他类或外部系统）进行隔离和模拟。| 白盒      | 细粒度 |
| 集成测试 | 一项内部功能 |多个类之间或与外部系统的交互。使用真实的协作者和外部系统。| 白盒 | 中等粒度 |
| 功能测试 | 一项外部功能 |绕过UI界面对每一项外部功能进行测试| 黑盒 | 粗粒度 |
| 性能和负载测试 | 一项外部功能 |测试系统执行某项功能有多快，以及能够支撑多大的并发量。| 黑盒 | 粗粒度 |
| 验收测试 | 整个系统 |通过UI界面测试系统的每项功能，检验系统是否已经准备就绪| 黑盒 | 最粗粒度 |

说明：

* 白盒和黑盒测试。白盒测试是看得见内部代码情况下进行的测试，包括单元测试和集成测试。由程序员而不是测试人员编写和运行，用于验证自己写的代码和/或交互是否正确。黑盒测试是不了解/不关心系统的代码和内部结构的情况下进行的测试，包括功能测试、性能和负载测试以及验收测试。由测试人员编写和运行，用于验证系统的功能和表现是否满足客户和用户的需要。
* 外部功能与内部功能。外部功能是客户和用户关心的功能（例如存款、取款、申报、索赔等等），是系统的业务价值所在。内部功能是开发人员定义的系统功能（例如缓存装载与查询，事件发布与订阅，等等），用于支撑外部功能的实现。
* 协作者和外部系统。要完成一项功能，通常都涉及到多个类之间，或者类与外部系统之间的交互协作。与其他类之间交互的例子是：下订单的时候，订单服务类要调用定价服务类来获取订单中每项商品的当前价格。与外部系统的交互包括与数据库、缓存、消息中间件、第三方服务提供者等等的交互。在单元测试中，要对所有的协作者和外部系统进行隔离和模拟。其他测试通常直接使用真实的协作者和外部系统，而不进行模拟。集成测试有时候会对部分外部系统进行模拟。

## 2. 测试金字塔

Mike Cohn 在他的著作《Succeeding with Agile》一书中提出了这个*测试金字塔*这个概念。这个比喻非常形象，它让你一眼就知道测试是需要分层的。它还告诉你每一层需要写多少测试。

![测试金字塔](https://insights.thoughtworks.cn/wp-content/uploads/2018/10/3.png)

在上图中，金字塔从下往上分别是单元测试、服务测试（相当于我们上面分类中的*功能测试*）和用户界面测试（相当于我们上面分类中的*验收测试*）。测试金字塔说明：

* 越是底层的测试，测试的数量越多；越是上层的测试，测试的数量越少。单元测试的测试量是最大的。每个工作单元都需要编写测试。实际上每个工作单元通常都需要写多个测试，以针对各种可能条件进行全面测试覆盖。
* 越是底层的测试，越需要能够快速执行。上层的测试则允许更长时间完成。所有的单元测试都应该能够在毫秒级时间内完成。
* 越是底层的测试，越需要隔离依赖项。越高层的测试，越需要集成更多的真实依赖项。底层的单元测试，要对一切依赖项（系统中的其他类和外部系统）进行隔离和模拟；而上层的测试需要集成系统中其他的类、子系统和外部系统，进行联合测试。

